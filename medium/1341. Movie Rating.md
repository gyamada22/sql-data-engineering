# 1341. Movie Rating

**Data:** 26/12/2025  
**Dificuldade:** Medium  
**Tópicos:** SQL, CTE, GROUP BY, ORDER BY, AVG, COUNT, UNION ALL  
**Link:** https://leetcode.com/problems/movie-rating/description/

## Descrição
Escreva uma solução para retornar **duas linhas**:

1. O **usuário que mais avaliou filmes**.  
   - Em caso de empate, retornar o **nome em ordem alfabética**.

2. O **filme com a maior média de avaliações em fevereiro de 2020**.  
   - Em caso de empate, retornar o **título em ordem alfabética**.

O resultado final deve conter **exatamente duas linhas**.

## Solução (SQL Server)

```sql
WITH cte1 AS (
    SELECT TOP 1 u.name
    FROM MovieRating mr 
    JOIN Users u ON mr.user_id = u.user_id
    GROUP BY u.name
    ORDER BY COUNT(mr.user_id) DESC, u.name ASC
),
cte2 AS (
    SELECT TOP 1 m.title
    FROM MovieRating mr 
    JOIN Movies m ON mr.movie_id = m.movie_id
    WHERE MONTH(created_at) = 2 
      AND YEAR(created_at) = 2020    
    GROUP BY m.title
    ORDER BY AVG(mr.rating * 1.0) DESC, m.title ASC
)

SELECT name AS results 
FROM cte1

UNION ALL

SELECT title 
FROM cte2;
